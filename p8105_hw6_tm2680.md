p8105\_hw6\_tm2680
================
Tatini Mal-Sarkar
11/21/2018

Problem 1
=========

``` r
hom_url = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"

hom_df = 
  read_csv(hom_url) %>% 
  janitor::clean_names() %>% 
  mutate(resolved = as.numeric(disposition == "Closed by arrest"),
         victim_age = as.numeric(victim_age),
         city_state = str_c(city, ", ", state),
         victim_race = as.numeric(victim_race != "White"),
         victim_sex = as.numeric(victim_sex == "Male")) %>% 
  filter(city_state != "Dallas, TX" & city_state != "Phoenix, AZ" & city_state != "Kansas City, MO" & city_state != "Tulsa, AL") %>% 
  select(city_state, resolved, victim_age, victim_race, victim_sex)
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_integer(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

    ## Warning in evalq(as.numeric(victim_age), <environment>): NAs introduced by
    ## coercion

``` r
hom_balt_df = 
  hom_df %>% 
  filter(city_state == "Baltimore, MD")

fit_log = 
  hom_balt_df %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

fit_log %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         lower_bound = exp(estimate - 1.96*std.error),
         upper_bound = exp(estimate + 1.96*std.error)) %>% 
  select(term, OR, lower_bound, upper_bound)
```

    ## # A tibble: 4 x 4
    ##   term           OR lower_bound upper_bound
    ##   <chr>       <dbl>       <dbl>       <dbl>
    ## 1 (Intercept) 3.27        2.07        5.19 
    ## 2 victim_age  0.993       0.987       0.999
    ## 3 victim_sex  0.412       0.315       0.537
    ## 4 victim_race 0.441       0.313       0.620

The adjusted odds ratio for solving homicides comparing non-white to white victims, keeping all other variables fixed, is 0.4406. We are 95% confident the true value for this OR lies between 0.3129 and 0.6204.

``` r
glm_func = function(df) {
  log = glm(resolved ~ victim_age + victim_sex + victim_race, data = df, family = binomial())
  
  broom::tidy(log) %>% 
    mutate(OR = exp(estimate),
         lower_bound = exp(estimate - 1.96*std.error),
         upper_bound = exp(estimate + 1.96*std.error)) %>% 
    filter(term == "victim_race") %>% 
    select(OR, lower_bound, upper_bound)
}
```

``` r
hom_df_glm = hom_df %>% 
  nest(resolved, victim_age, victim_sex, victim_race) %>% 
  mutate(models = map(data, glm_func)) %>% 
  unnest(models) %>% 
  select(-data)
```

``` r
hom_df_glm 
```

    ## # A tibble: 47 x 4
    ##    city_state         OR lower_bound upper_bound
    ##    <chr>           <dbl>       <dbl>       <dbl>
    ##  1 Albuquerque, NM 0.951      0.590        1.53 
    ##  2 Atlanta, GA     0.753      0.432        1.31 
    ##  3 Baltimore, MD   0.441      0.313        0.620
    ##  4 Baton Rouge, LA 0.668      0.313        1.43 
    ##  5 Birmingham, AL  1.04       0.616        1.76 
    ##  6 Boston, MA      0.118      0.0489       0.285
    ##  7 Buffalo, NY     0.390      0.213        0.715
    ##  8 Charlotte, NC   0.558      0.321        0.969
    ##  9 Chicago, IL     0.559      0.429        0.729
    ## 10 Cincinnati, OH  0.319      0.184        0.552
    ## # ... with 37 more rows
