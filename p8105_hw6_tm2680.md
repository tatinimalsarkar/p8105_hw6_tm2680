p8105\_hw6\_tm2680
================
Tatini Mal-Sarkar
11/21/2018

Problem 1
=========

``` r
hom_url = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"

hom_df = 
  read_csv(hom_url) %>% 
  janitor::clean_names() %>% 
  mutate(resolved = as.numeric(disposition == "Closed by arrest"),
         victim_age = as.numeric(victim_age),
         city_state = str_c(city, ", ", state),
         victim_race = as.numeric(victim_race != "White"),
         victim_sex = as.numeric(victim_sex == "Male")) %>% 
  filter(city_state != "Dallas, TX" & city_state != "Phoenix, AZ" & city_state != "Kansas City, MO" & city_state != "Tulsa, AL") %>% 
  select(city_state, resolved, victim_age, victim_race, victim_sex)
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_integer(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

    ## Warning in evalq(as.numeric(victim_age), <environment>): NAs introduced by
    ## coercion

``` r
hom_balt_df = 
  hom_df %>% 
  filter(city_state == "Baltimore, MD")

fit_log = 
  hom_balt_df %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

fit_log %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         lower_bound = exp(estimate - 1.96*std.error),
         upper_bound = exp(estimate + 1.96*std.error)) %>% 
  select(term, OR, lower_bound, upper_bound)
```

    ## # A tibble: 4 x 4
    ##   term           OR lower_bound upper_bound
    ##   <chr>       <dbl>       <dbl>       <dbl>
    ## 1 (Intercept) 3.27        2.07        5.19 
    ## 2 victim_age  0.993       0.987       0.999
    ## 3 victim_sex  0.412       0.315       0.537
    ## 4 victim_race 0.441       0.313       0.620

The adjusted odds ratio for solving homicides comparing non-white to white victims, keeping all other variables fixed, is 0.4406. We are 95% confident the true value for this OR lies between 0.3129 and 0.6204.

``` r
glm_func = function(df) {
  log = glm(resolved ~ victim_age + victim_sex + victim_race, data = df, family = binomial())
  
  broom::tidy(log) %>% 
    mutate(OR = exp(estimate),
         lower_bound = exp(estimate - 1.96*std.error),
         upper_bound = exp(estimate + 1.96*std.error)) %>% 
    filter(term == "victim_race") %>% 
    select(OR, lower_bound, upper_bound)
}
```

``` r
hom_df_glm = hom_df %>% 
  nest(resolved, victim_age, victim_sex, victim_race) %>% 
  mutate(models = map(data, glm_func)) %>% 
  unnest(models) %>% 
  select(-data)
```

``` r
hom_df_glm %>% 
  mutate(city_state = forcats::fct_reorder(city_state, OR)) %>% 
  ggplot(aes(x = city_state, y = OR)) + 
  geom_bar(stat = "identity") + 
  geom_errorbar(aes(ymin = lower_bound, ymax = upper_bound), width = 0.2) + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Solving homicides for non-white vs. white victims",
         x = "City",
         y = "OR")
```

![](p8105_hw6_tm2680_files/figure-markdown_github/hom_glm_plot-1.png)

This plot depicts the odds ratio of solving a homicide for a non-white victim compared to a white victim. In cities like Boston, the odds of solving a murder for a non-white victim is 0.118 times the odds of solving a murder for a white victim. We're 95% confident the true value for this OR would lie between 0.049 and 0.285. Because this range doesn't include the null OR value of 1, resolving a homicide and victim race are significantly associated. In other words, in a city like Boston, white victims are likelier to have their case solved. The reverse might hold true in a city like Tampa, where the estimated OR is 1.159. However, because the 95% confidence interval ranges from 0.587 to 2.288, race and resolving a homicide might not be associated.

Problem 2
=========

``` r
bw_df = read_csv("./data/birthweight.csv") %>% 
  janitor::clean_names() %>% 
  mutate(babysex = as.factor(babysex),
         frace = as.factor(frace),
         mrace = as.factor(mrace),
         missing = sum(is.na(babysex:wtgain)))
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_integer(),
    ##   gaweeks = col_double(),
    ##   ppbmi = col_double(),
    ##   smoken = col_double()
    ## )

    ## See spec(...) for full column specifications.

    ## Warning in babysex:wtgain: numerical expression has 4342 elements: only the
    ## first used

    ## Warning in babysex:wtgain: numerical expression has 4342 elements: only the
    ## first used

To build this model, I first narrowed my focus to examining social factors that may influence child birthweight, specifically socioeconomic status and race. To that end, my predictor variables include `fincome` and `mrace`. I recoded `mrace` to white (0) and non-white (1). I hypothesized that higher family income and a white mother lead to higher baby weight.

First, I tried linear models including each predictor variable individually.

``` r
bw_df_mod = bw_df %>% 
  mutate(mrace = as.numeric(mrace != "White"))
  
# Fit of mother's race alone
fit_mrace = lm(bwt ~ mrace, data = bw_df_mod)
summary(fit_mrace)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ mrace, data = bw_df_mod)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -2519.4  -307.4    18.1   344.6  1676.6 
    ## 
    ## Coefficients: (1 not defined because of singularities)
    ##             Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) 3114.404      7.772   400.7   <2e-16 ***
    ## mrace             NA         NA      NA       NA    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 512.2 on 4341 degrees of freedom

``` r
# Fit of family income alone
fit_fincome = lm(bwt ~ fincome, data = bw_df_mod)
summary(fit_fincome)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ fincome, data = bw_df_mod)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -2592.56  -284.61     9.77   336.92  1704.35 
    ## 
    ## Coefficients:
    ##              Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) 2979.9872    15.1348  196.90   <2e-16 ***
    ## fincome        3.0476     0.2957   10.31   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 506.1 on 4340 degrees of freedom
    ## Multiple R-squared:  0.02389,    Adjusted R-squared:  0.02367 
    ## F-statistic: 106.2 on 1 and 4340 DF,  p-value: < 2.2e-16

Then, I tested whether adding maternal race to family income as predictors made a difference, using ANOVA.

``` r
# ANOVA of adding maternal race to family income
fit_null_1 = lm(bwt ~ fincome, data = bw_df_mod)
fit_alt_1 = lm(bwt ~ fincome + mrace, data = bw_df_mod)

anova(fit_null_1, fit_alt_1) %>% 
  broom::tidy()
```

    ## Warning: Unknown or uninitialised column: 'term'.

    ## # A tibble: 2 x 6
    ##   res.df         rss    df sumsq statistic p.value
    ## *  <dbl>       <dbl> <dbl> <dbl>     <dbl>   <dbl>
    ## 1   4340 1111447115.    NA    NA        NA      NA
    ## 2   4340 1111447115.     0     0        NA      NA

Finally, I tested whether adding family income to maternal race as predictors made a difference, using ANOVA once again.

``` r
# ANOVA of adding family income to maternal race
fit_null_2 = lm(bwt ~ mrace, data = bw_df_mod)
fit_alt_2 = lm(bwt ~ mrace + fincome, data = bw_df_mod)

anova(fit_null_2, fit_alt_2) %>% 
  broom::tidy()
```

    ## Warning: Unknown or uninitialised column: 'term'.

    ## # A tibble: 2 x 6
    ##   res.df         rss    df     sumsq statistic   p.value
    ## *  <dbl>       <dbl> <dbl>     <dbl>     <dbl>     <dbl>
    ## 1   4341 1138652193.    NA       NA        NA  NA       
    ## 2   4340 1111447115.     1 27205079.      106.  1.26e-24
